<div class="home-page">
  <div class="home-content">
    <div class="main-actions">
      <!-- Titre principal SEO -->
      <h1 class="page-title">Maîtrisez vos passages de grade grâce à un entraînement personnalisé</h1>
      
      <!-- Carousel des modes de passage -->
      <div class="mode-carousel-wrapper">
        <button class="carousel-nav carousel-nav-left" (click)="previousMode()" aria-label="Mode précédent" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        
        <div class="logo-container">
          <!-- Boutons de navigation sur mobile, positionnés sur le panel -->
          <button class="carousel-nav carousel-nav-left-mobile" (click)="previousMode()" aria-label="Mode précédent" type="button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <button class="carousel-nav carousel-nav-right-mobile" (click)="nextMode()" aria-label="Mode suivant" type="button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          
          <div class="mode-icon-wrapper">
            <div class="mode-icon">
              <!-- SVG Classique - Style logo avec livre/rouleau traditionnel -->
            <svg *ngIf="currentMode.id === 'classique'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200">
              <defs>
                <linearGradient id="classiqueRedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#c41e3a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e63946;stop-opacity:0.8" />
                </linearGradient>
                <linearGradient id="classiqueBlackGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#1a1a1a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#2d2d2d;stop-opacity:0.9" />
                </linearGradient>
                <filter id="classiqueShadow">
                  <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                  <feOffset dx="2" dy="2" result="offsetblur"/>
                  <feComponentTransfer>
                    <feFuncA type="linear" slope="0.3"/>
                  </feComponentTransfer>
                  <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>
              <circle cx="100" cy="100" r="92" fill="none" stroke="url(#classiqueBlackGradient)" stroke-width="5" opacity="0.95"/>
              <circle cx="100" cy="100" r="85" fill="none" stroke="#c41e3a" stroke-width="1.5" opacity="0.4"/>
              <circle cx="100" cy="100" r="75" fill="none" stroke="#1a1a1a" stroke-width="1" opacity="0.3"/>
              <circle cx="100" cy="100" r="65" fill="none" stroke="#c41e3a" stroke-width="1" opacity="0.3"/>
              <!-- Livre ouvert / Rouleau traditionnel -->
              <rect x="60" y="70" width="80" height="60" rx="4" fill="url(#classiqueRedGradient)" opacity="0.9" filter="url(#classiqueShadow)"/>
              <rect x="65" y="75" width="70" height="50" rx="3" fill="url(#classiqueBlackGradient)" opacity="0.85"/>
              <!-- Lignes de texte (représentant l'ordre classique) -->
              <line x1="75" y1="90" x2="125" y2="90" stroke="#c41e3a" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
              <line x1="75" y1="100" x2="125" y2="100" stroke="#c41e3a" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
              <line x1="75" y1="110" x2="125" y2="110" stroke="#c41e3a" stroke-width="2" stroke-linecap="round" opacity="0.8"/>
              <!-- Reliure centrale -->
              <line x1="100" y1="75" x2="100" y2="125" stroke="#c41e3a" stroke-width="3" stroke-linecap="round" opacity="0.6"/>
              <g stroke="#c41e3a" stroke-width="1.5" opacity="0.4">
                <line x1="100" y1="100" x2="100" y2="20" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="100" y2="180" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="20" y2="100" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="180" y2="100" stroke-linecap="round"/>
              </g>
              <circle cx="100" cy="20" r="3" fill="#c41e3a" opacity="0.8"/>
              <circle cx="100" cy="180" r="3" fill="#1a1a1a" opacity="0.8"/>
            </svg>
            
              <!-- SVG Progression - Style logo avec flèches vers le haut -->
            <svg *ngIf="currentMode.id === 'progression'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200">
              <defs>
                <linearGradient id="progressionRedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#c41e3a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e63946;stop-opacity:0.8" />
                </linearGradient>
                <linearGradient id="progressionBlackGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#1a1a1a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#2d2d2d;stop-opacity:0.9" />
                </linearGradient>
                <filter id="progressionShadow">
                  <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                  <feOffset dx="2" dy="2" result="offsetblur"/>
                  <feComponentTransfer>
                    <feFuncA type="linear" slope="0.3"/>
                  </feComponentTransfer>
                  <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>
              <circle cx="100" cy="100" r="92" fill="none" stroke="url(#progressionBlackGradient)" stroke-width="5" opacity="0.95"/>
              <circle cx="100" cy="100" r="85" fill="none" stroke="#c41e3a" stroke-width="1.5" opacity="0.4"/>
              <circle cx="100" cy="100" r="75" fill="none" stroke="#1a1a1a" stroke-width="1" opacity="0.3"/>
              <circle cx="100" cy="100" r="65" fill="none" stroke="#c41e3a" stroke-width="1" opacity="0.3"/>
              <!-- Flèches progression vers le haut -->
              <path d="M 100 40 L 120 70 L 110 70 L 110 120 L 90 120 L 90 70 L 80 70 Z" fill="url(#progressionRedGradient)" opacity="0.9" filter="url(#progressionShadow)"/>
              <path d="M 100 50 L 110 70 L 100 85 L 90 70 Z" fill="url(#progressionBlackGradient)" opacity="0.85"/>
              <g stroke="#c41e3a" stroke-width="1.5" opacity="0.4">
                <line x1="100" y1="100" x2="100" y2="20" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="20" y2="100" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="180" y2="100" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="140" y2="60" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="60" y2="60" stroke-linecap="round"/>
              </g>
              <circle cx="100" cy="20" r="3" fill="#c41e3a" opacity="0.8"/>
              <circle cx="100" cy="100" r="8" fill="#ffffff" opacity="0.9"/>
              <circle cx="100" cy="100" r="5" fill="#c41e3a"/>
            </svg>
            
            <!-- SVG Aléatoire - Style logo avec motif shuffle -->
            <svg *ngIf="currentMode.id === 'aleatoire'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200">
              <defs>
                <linearGradient id="aleatoireRedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#c41e3a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e63946;stop-opacity:0.8" />
                </linearGradient>
                <linearGradient id="aleatoireBlackGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#1a1a1a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#2d2d2d;stop-opacity:0.9" />
                </linearGradient>
                <filter id="aleatoireShadow">
                  <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                  <feOffset dx="2" dy="2" result="offsetblur"/>
                  <feComponentTransfer>
                    <feFuncA type="linear" slope="0.3"/>
                  </feComponentTransfer>
                  <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>
              <circle cx="100" cy="100" r="92" fill="none" stroke="url(#aleatoireBlackGradient)" stroke-width="5" opacity="0.95"/>
              <circle cx="100" cy="100" r="85" fill="none" stroke="#c41e3a" stroke-width="1.5" opacity="0.4"/>
              <circle cx="100" cy="100" r="75" fill="none" stroke="#1a1a1a" stroke-width="1" opacity="0.3"/>
              <circle cx="100" cy="100" r="65" fill="none" stroke="#c41e3a" stroke-width="1" opacity="0.3"/>
              <!-- Motif shuffle/croisement -->
              <path d="M 60 60 L 140 60 L 140 80 L 100 100 L 140 120 L 140 140 L 60 140 L 60 120 L 100 100 L 60 80 Z" fill="url(#aleatoireRedGradient)" opacity="0.9" filter="url(#aleatoireShadow)"/>
              <path d="M 70 70 L 130 70 L 130 85 L 100 100 L 130 115 L 130 130 L 70 130 L 70 115 L 100 100 L 70 85 Z" fill="url(#aleatoireBlackGradient)" opacity="0.85"/>
              <g stroke="#c41e3a" stroke-width="1.5" opacity="0.4">
                <line x1="100" y1="100" x2="60" y2="60" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="140" y2="60" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="60" y2="140" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="140" y2="140" stroke-linecap="round"/>
              </g>
              <circle cx="100" cy="100" r="8" fill="#ffffff" opacity="0.9"/>
              <circle cx="100" cy="100" r="5" fill="#c41e3a"/>
            </svg>
            
            <!-- SVG Révision - Style logo avec checkmark -->
            <svg *ngIf="currentMode.id === 'revision'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="200" height="200">
              <defs>
                <linearGradient id="revisionRedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#c41e3a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#e63946;stop-opacity:0.8" />
                </linearGradient>
                <linearGradient id="revisionBlackGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#1a1a1a;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#2d2d2d;stop-opacity:0.9" />
                </linearGradient>
                <filter id="revisionShadow">
                  <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                  <feOffset dx="2" dy="2" result="offsetblur"/>
                  <feComponentTransfer>
                    <feFuncA type="linear" slope="0.3"/>
                  </feComponentTransfer>
                  <feMerge>
                    <feMergeNode/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>
              </defs>
              <circle cx="100" cy="100" r="92" fill="none" stroke="url(#revisionBlackGradient)" stroke-width="5" opacity="0.95"/>
              <circle cx="100" cy="100" r="85" fill="none" stroke="#c41e3a" stroke-width="1.5" opacity="0.4"/>
              <circle cx="100" cy="100" r="75" fill="none" stroke="#1a1a1a" stroke-width="1" opacity="0.3"/>
              <circle cx="100" cy="100" r="65" fill="none" stroke="#c41e3a" stroke-width="1" opacity="0.3"/>
              <!-- Cercle avec checkmark -->
              <circle cx="100" cy="100" r="50" fill="url(#revisionRedGradient)" opacity="0.9" filter="url(#revisionShadow)"/>
              <circle cx="100" cy="100" r="40" fill="url(#revisionBlackGradient)" opacity="0.85"/>
              <path d="M 75 100 L 90 115 L 125 80" fill="none" stroke="#c41e3a" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
              <g stroke="#c41e3a" stroke-width="1.5" opacity="0.4">
                <line x1="100" y1="100" x2="100" y2="20" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="100" y2="180" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="20" y2="100" stroke-linecap="round"/>
                <line x1="100" y1="100" x2="180" y2="100" stroke-linecap="round"/>
              </g>
              <circle cx="100" cy="20" r="3" fill="#c41e3a" opacity="0.8"/>
              <circle cx="100" cy="180" r="3" fill="#1a1a1a" opacity="0.8"/>
            </svg>
            </div>
          </div>
          <div class="mode-text">
            <div class="mode-name">{{ currentMode.name }}</div>
            <div class="mode-description">{{ currentMode.description }}</div>
          </div>
        </div>
        
        <button class="carousel-nav carousel-nav-right" (click)="nextMode()" aria-label="Mode suivant" type="button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      
      <div class="buttons-container" [class.revision-mode]="currentMode.id === 'revision'">
        <button class="start-button" (click)="startPassage()" type="button">
          Hajime | 始め
        </button>
        
        <!-- Bouton de filtrage des techniques (visible uniquement en mode révision) -->
        <button 
          *ngIf="shouldShowTechniqueFilter"
          class="technique-filter-button"
          (click)="openTechniqueFilter()"
          type="button"
          title="Configurer les filtres de techniques"
          aria-label="Ouvrir les filtres de techniques">
          <img src="assets/images/technique.png" alt="Icône technique" class="technique-icon">
        </button>
        
        <!-- Bouton de configuration visible uniquement sur mobile -->
        <a *ngIf="isMobile" routerLink="/config" class="config-button" title="Configuration" aria-label="Configuration">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </a>
      </div>
    </div>
    
    <!-- Panel de configuration visible uniquement sur PC -->
    <div class="config-panel" *ngIf="!isMobile">
      <div class="config-content" #configContent (scroll)="onConfigContentScroll()">
        <!-- Icône de réglage en haut à droite -->
        <div class="config-settings-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </div>
        <!-- Section Sélection du grade -->
        <div class="config-section grade-selection-section">
          <h3>Sélection du grade</h3>
          <p class="config-description">Choisissez le grade pour lequel vous souhaitez vous entraîner</p>
          
          <!-- Bouton avec dropdown pour la sélection du grade -->
          <div class="grade-selector">
            <button
              type="button"
              class="grade-select-button"
              [class.open]="isGradeDropdownOpen"
              (click)="toggleGradeDropdown()"
              [attr.aria-expanded]="isGradeDropdownOpen"
              aria-haspopup="listbox"
              aria-label="Sélectionner le grade">
              <span class="grade-select-label">Grade:</span>
              <span class="grade-select-value">{{ selectedGrade }}</span>
              <svg class="grade-select-chevron" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="4 6 8 10 12 6"></polyline>
              </svg>
            </button>

            <!-- Dropdown menu -->
            <div
              *ngIf="isGradeDropdownOpen"
              class="grade-dropdown"
              role="listbox"
              aria-label="Liste des grades">
              <button
                *ngFor="let grade of grades"
                type="button"
                class="grade-option"
                [class.selected]="selectedGrade === grade"
                (click)="onGradeSelect(grade)"
                role="option"
                [attr.aria-selected]="selectedGrade === grade">
                {{ grade }}
              </button>
            </div>
          </div>
        </div>

        <!-- Section Options supplémentaires -->
        <div class="config-section additional-options-section">
          <h3>Options supplémentaires</h3>
          <p class="config-description">Allouer du temps spécifique aux armes ou au randori</p>
          
          <!-- Toggles pour armes et randori -->
          <div class="weapon-randori-toggles">
            <!-- Toggle pour inclure le temps dédié aux armes (affiché uniquement si grade >= 1er Kyū) -->
            <div class="weapon-time-toggle-mobile" *ngIf="shouldShowWeaponToggle">
              <label class="weapon-time-toggle-label">
                <span class="weapon-time-toggle-text">Dédier un temps aux armes</span>
                <button
                  type="button"
                  class="weapon-time-toggle-button"
                  [class.active]="includeWeaponTime"
                  (click)="toggleIncludeWeaponTime()"
                  [attr.aria-pressed]="includeWeaponTime"
                  [attr.aria-label]="includeWeaponTime ? 'Désactiver le temps dédié aux armes' : 'Activer le temps dédié aux armes'">
                  <span class="weapon-time-toggle-slider"></span>
                </button>
              </label>
            </div>

            <!-- Toggle pour inclure le temps dédié au randori (toujours visible) -->
            <div class="weapon-time-toggle-mobile">
              <label class="weapon-time-toggle-label">
                <div class="weapon-time-toggle-text-container">
                  <span class="weapon-time-toggle-text">Dédier du temps pour un RANDORI</span>
                  <span class="weapon-time-toggle-duration">(3 min)</span>
                </div>
                <button
                  type="button"
                  class="weapon-time-toggle-button"
                  [class.active]="includeRandoriTime"
                  (click)="toggleIncludeRandoriTime()"
                  [attr.aria-pressed]="includeRandoriTime"
                  [attr.aria-label]="includeRandoriTime ? 'Désactiver le temps dédié au randori (3 min)' : 'Activer le temps dédié au randori (3 min)'">
                  <span class="weapon-time-toggle-slider"></span>
                </button>
              </label>
            </div>

            <!-- Section des boutons Pill/Tab style pour PC -->
            <div class="pill-toggles-container">
              <div class="pill-toggles-buttons">
              <button
                type="button"
                class="pill-toggle-button"
                *ngIf="shouldShowWeaponToggle"
                [class.active]="includeWeaponTime"
                (click)="toggleIncludeWeaponTime()"
                [attr.aria-pressed]="includeWeaponTime"
                [attr.aria-label]="includeWeaponTime ? 'Désactiver le temps dédié aux armes' : 'Activer le temps dédié aux armes'">
                ARMES
              </button>

              <button
                type="button"
                class="pill-toggle-button"
                [class.active]="includeRandoriTime"
                (click)="toggleIncludeRandoriTime()"
                [attr.aria-pressed]="includeRandoriTime"
                [attr.aria-label]="includeRandoriTime ? 'Désactiver le temps dédié au randori (3 min)' : 'Activer le temps dédié au randori (3 min)'">
                RANDORI<span class="pill-toggle-duration"> (3 min)</span>
              </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Section Configuration du temps -->
        <div class="config-section time-configuration-section">
          <h3>Configuration du temps</h3>
          <p class="config-description">Configurez le rythme de votre entraînement</p>
          
          <!-- Conteneur pour les 3 contrôles de temps (affichage en ligne sur PC) -->
          <div class="time-controls-row">
            <!-- Contrôle Temps entre techniques -->
            <div class="time-control">
              <label class="time-control-label">Temps entre techniques</label>
              <div class="time-input-group">
                <button
                  type="button"
                  class="time-input-button"
                  (click)="decrementTimeBetween()"
                  [disabled]="timeBetweenTechniques <= MIN_TIME_BETWEEN"
                  [attr.aria-label]="'Diminuer le temps entre techniques'"
                  [attr.aria-disabled]="timeBetweenTechniques <= MIN_TIME_BETWEEN">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="8" x2="12" y2="8"></line>
                  </svg>
                </button>
                <span class="time-value" [attr.aria-valuemin]="MIN_TIME_BETWEEN" [attr.aria-valuemax]="MAX_TIME_BETWEEN" [attr.aria-valuenow]="timeBetweenTechniques">
                  {{ timeBetweenTechniques }}
                </span>
                <span class="time-input-unit">secondes</span>
                <button
                  type="button"
                  class="time-input-button"
                  (click)="incrementTimeBetween()"
                  [disabled]="timeBetweenTechniques >= MAX_TIME_BETWEEN"
                  [attr.aria-label]="'Augmenter le temps entre techniques'"
                  [attr.aria-disabled]="timeBetweenTechniques >= MAX_TIME_BETWEEN">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="4" x2="8" y2="12"></line>
                    <line x1="4" y1="8" x2="12" y2="8"></line>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Contrôle Temps dédié aux armes (affiché uniquement si grade >= 1er Kyū) -->
            <div class="time-control" *ngIf="shouldShowWeaponTime">
              <label class="time-control-label">Temps dédié aux armes</label>
              <div class="time-input-group">
                <button
                  type="button"
                  class="time-input-button"
                  (click)="decrementWeaponTime()"
                  [disabled]="weaponTime <= MIN_WEAPON_TIME"
                  [attr.aria-label]="'Diminuer le temps dédié aux armes'"
                  [attr.aria-disabled]="weaponTime <= MIN_WEAPON_TIME">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="8" x2="12" y2="8"></line>
                  </svg>
                </button>
                <span class="time-value" [attr.aria-valuemin]="MIN_WEAPON_TIME" [attr.aria-valuemax]="MAX_WEAPON_TIME" [attr.aria-valuenow]="weaponTime">
                  {{ weaponTime }}
                </span>
                <span class="time-input-unit">minutes</span>
                <button
                  type="button"
                  class="time-input-button"
                  (click)="incrementWeaponTime()"
                  [disabled]="weaponTime >= MAX_WEAPON_TIME"
                  [attr.aria-label]="'Augmenter le temps dédié aux armes'"
                  [attr.aria-disabled]="weaponTime >= MAX_WEAPON_TIME">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="4" x2="8" y2="12"></line>
                    <line x1="4" y1="8" x2="12" y2="8"></line>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Contrôle Durée totale -->
            <div class="time-control">
              <label class="time-control-label">Durée totale</label>
              <div class="time-input-group">
                <button
                  type="button"
                  class="time-input-button"
                  (click)="decrementDuration()"
                  [disabled]="totalDuration <= MIN_DURATION"
                  [attr.aria-label]="'Diminuer la durée totale'"
                  [attr.aria-disabled]="totalDuration <= MIN_DURATION">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="8" x2="12" y2="8"></line>
                  </svg>
                </button>
                <span class="time-value" [attr.aria-valuemin]="MIN_DURATION" [attr.aria-valuemax]="MAX_DURATION" [attr.aria-valuenow]="totalDuration">
                  {{ totalDuration }}
                </span>
                <span class="time-input-unit">minutes</span>
                <button
                  type="button"
                  class="time-input-button"
                  (click)="incrementDuration()"
                  [disabled]="totalDuration >= MAX_DURATION"
                  [attr.aria-label]="'Augmenter la durée totale'"
                  [attr.aria-disabled]="totalDuration >= MAX_DURATION">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="4" x2="8" y2="12"></line>
                    <line x1="4" y1="8" x2="12" y2="8"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Aperçu du nombre estimé de techniques -->
          <div class="time-preview">
            <p class="time-preview-text">
              Environ <strong class="time-preview-count">{{ estimatedTechniqueCount }}</strong> technique{{ estimatedTechniqueCount > 1 ? 's' : '' }} seront annoncée{{ estimatedTechniqueCount > 1 ? 's' : '' }} <span *ngIf="exclusionText">{{ exclusionText }}</span>
            </p>
          </div>
        </div>

        <!-- Section Sélection de la voix -->
        <div class="config-section voice-selection-section">
          <h3>Sélection de la voix</h3>
          <p class="config-description">Choisissez une voix pour les annonces ({{ availableVoices.length }} voix disponibles)</p>
          
          <!-- Voix japonaises -->
          <div class="voice-language-group voice-language-group-japanese">
            <h4 class="voice-language-title">Voix japonaises</h4>
            <div class="voice-selector">
              <button
                *ngFor="let voice of japaneseVoices"
                (click)="onVoiceChange(voice)"
                class="voice-option"
                [class.active]="isVoiceSelected(voice)"
                [attr.aria-label]="'Sélectionner la voix ' + voice.displayName"
                type="button">
                <div class="voice-preview">
                  <img 
                    [src]="'assets/images/avatar/' + voice.language + '/' + voice.id + '.png'" 
                    [alt]="voice.displayName"
                    class="voice-avatar" />
                </div>
                <span class="voice-name">{{ voice.displayName }}</span>
              </button>
            </div>
          </div>

          <!-- Voix françaises -->
          <div class="voice-language-group voice-language-group-french">
            <h4 class="voice-language-title">Voix françaises</h4>
            <div class="voice-selector">
              <button
                *ngFor="let voice of frenchVoices"
                (click)="onVoiceChange(voice)"
                class="voice-option"
                [class.active]="isVoiceSelected(voice)"
                [attr.aria-label]="'Sélectionner la voix ' + voice.displayName"
                type="button">
                <div class="voice-preview">
                  <img 
                    [src]="'assets/images/avatar/' + voice.language + '/' + voice.id + '.png'" 
                    [alt]="voice.displayName"
                    class="voice-avatar" />
                </div>
                <span class="voice-name">{{ voice.displayName }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Les autres sections de configuration seront ajoutées dans les stories suivantes -->
      </div>
      
      <!-- Icône de souris animée pour indiquer le scroll (PC uniquement) -->
      <div class="config-scroll-indicator" [class.hidden]="isScrollAtBottom || !hasScroll">
        <div class="scroll-indicator-content">
          <svg class="mouse-icon" width="32" height="42" viewBox="0 0 24 32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <!-- Corps de la souris -->
            <rect x="7" y="2" width="10" height="18" rx="5" fill="none" stroke="currentColor"/>
            <!-- Roulette de scroll -->
            <circle cx="12" cy="8" r="1.5" fill="currentColor"/>
          </svg>
          <svg class="chevron-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup/Modal pour Technique Filter -->
  <div class="technique-filter-overlay" 
       *ngIf="isTechniqueFilterOpen" 
       [class.closing]="isTechniqueFilterClosing"
       (click)="closeTechniqueFilter()">
    <div class="technique-filter-popup" 
         [class.mobile]="isMobile"
         [class.closing]="isTechniqueFilterClosing"
         (click)="$event.stopPropagation()">
      <div class="technique-filter-popup-header">
        <h2>Filtre de techniques</h2>
        <button 
          type="button"
          class="close-button"
          (click)="closeTechniqueFilter()"
          aria-label="Fermer">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <app-technique-filter
        [grade]="selectedGrade"
        [currentSelection]="currentTechniqueSelection"
        [isMobile]="isMobile"
        (selectionApplied)="onTechniqueSelectionApplied($event)"
        (cancelled)="onTechniqueSelectionCancelled()">
      </app-technique-filter>
    </div>
  </div>
</div>
