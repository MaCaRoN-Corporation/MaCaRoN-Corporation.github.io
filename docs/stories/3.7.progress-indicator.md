# Story 3.7: Progress Indicator

**Status:** Done  
**Epic:** 3 - Passage Generation & Core Execution  
**Story Number:** 3.7  

---

## Story

**As a** user,  
**I want** voir ma progression dans le passage (Technique X sur Y),  
**so that** je peux savoir où j'en suis dans l'entraînement.

---

## Acceptance Criteria

1. Un indicateur "Technique X sur Y total" est affiché sur la page de passage
2. L'indicateur se met à jour automatiquement à chaque nouvelle technique
3. L'indicateur est bien visible mais non intrusif
4. Le format est clair et lisible (ex: "3 / 15")
5. Une barre de progression visuelle est également affichée
6. La barre de progression se remplit progressivement (X/Y * 100%)
7. La barre de progression est animée de manière fluide lors des mises à jour

---

## Tasks / Subtasks

- [ ] **Task 1: Create Progress Indicator Section** (AC: 1, 3)
  - [ ] Créer la section pour l'indicateur de progression
  - [ ] Positionner de manière visible mais non intrusive
  - [ ] Intégrer dans PassageComponent template
  - [ ] Styles CSS pour visibilité appropriée

- [ ] **Task 2: Implement Text Indicator (X / Y)** (AC: 2, 4)
  - [ ] Afficher "Technique X sur Y total"
  - [ ] Calculer X (currentTechniqueIndex + 1) et Y (total techniques)
  - [ ] Format clair et lisible (ex: "3 / 15")
  - [ ] Mettre à jour automatiquement à chaque nouvelle technique

- [ ] **Task 3: Integrate with PassageService** (AC: 2)
  - [ ] Récupérer currentTechniqueIndex depuis PassageState
  - [ ] Calculer le total de techniques depuis currentPassage
  - [ ] Écouter les changements d'état pour mettre à jour
  - [ ] Inclure Randori dans le total si activé

- [ ] **Task 4: Create Progress Bar Visual Element** (AC: 5, 6)
  - [ ] Créer la barre de progression visuelle (div avec background)
  - [ ] Calculer le pourcentage (X/Y * 100%)
  - [ ] Afficher la barre qui se remplit progressivement
  - [ ] Styles CSS pour la barre (couleur, hauteur, border-radius)

- [ ] **Task 5: Implement Smooth Progress Bar Animation** (AC: 7)
  - [ ] Utiliser CSS transitions ou Angular Animations
  - [ ] Animer la barre de progression de manière fluide
  - [ ] Transition lors des mises à jour
  - [ ] Durée d'animation appropriée (300-500ms)

- [ ] **Task 6: Handle Edge Cases** (AC: 2)
  - [ ] Gérer le cas où currentPassage est null
  - [ ] Gérer le cas où total = 0
  - [ ] Gérer la progression à 0% et 100%
  - [ ] Gérer Randori dans le calcul du total

- [ ] **Task 7: Style Progress Indicator** (AC: 3, 4)
  - [ ] Styles pour l'indicateur texte (taille, couleur, position)
  - [ ] Styles pour la barre de progression (couleur, hauteur, border-radius)
  - [ ] Design non intrusif mais visible
  - [ ] Responsive design (mobile et desktop)

- [ ] **Task 8: Create Unit Tests** (AC: 1-7)
  - [ ] Tester l'affichage "X / Y"
  - [ ] Tester le calcul du pourcentage
  - [ ] Tester la mise à jour automatique
  - [ ] Tester la barre de progression
  - [ ] Tester l'animation
  - [ ] Tester l'intégration avec PassageService
  - [ ] Tester les cas limites (null, 0, 100%)

---

## Dev Notes

### Previous Story Insights

**Source:** Story 3.6 - Technique History Display
- PassageComponent structure en place
- PassageService intégré
- PassageState disponible

**Source:** Story 3.2 - Passage State Management
- PassageState contient currentTechniqueIndex et currentPassage
- Nombre total de techniques calculable depuis currentPassage.techniques.length
- Support Randori dans le total

### Technical Context

**Source:** [architecture/frontend-architecture.md](../../architecture/frontend-architecture.md)

**PassageComponent:**
- **Location:** `src/app/pages/passage/passage.ts`, `passage.html`, `passage.scss`
- **Dependencies:** PassageService pour la progression

**Progress Calculation:**
- Current index: currentTechniqueIndex (0-based)
- Current technique number: currentTechniqueIndex + 1 (1-based pour affichage)
- Total techniques: currentPassage.techniques.length (+ 1 si Randori activé)
- Progress percentage: (currentTechniqueIndex + 1) / total * 100

**Display Format:**
- Texte: "3 / 15" ou "Technique 3 sur 15"
- Barre: Pourcentage visuel (ex: 20% = 1/5, 40% = 2/5, etc.)

**Progress Bar Design:**
- Barre de fond (background) avec couleur de base
- Barre de remplissage (foreground) avec couleur d'accent/primary
- Hauteur appropriée (8-12px)
- Border-radius pour coins arrondis
- Animation fluide lors des changements

### Implementation Details

**Progress Calculation:**
```typescript
getProgress(): { current: number; total: number; percentage: number } {
  const state = this.passageService.getPassageState().value;
  if (!state.currentPassage) {
    return { current: 0, total: 0, percentage: 0 };
  }
  
  const total = state.currentPassage.techniques.length + 
    (state.currentPassage.includeRandoriTime ? 1 : 0);
  const current = state.currentTechniqueIndex + 1;
  const percentage = total > 0 ? (current / total) * 100 : 0;
  
  return { current, total, percentage };
}
```

**Template Structure:**
```html
<div class="progress-indicator">
  <div class="progress-text">
    {{ progress.current }} / {{ progress.total }}
  </div>
  <div class="progress-bar">
    <div 
      class="progress-fill"
      [style.width.%]="progress.percentage"
      [@progressAnimation]="progress.percentage"
    ></div>
  </div>
</div>
```

**Styles CSS:**
```scss
.progress-indicator {
  padding: 1rem;
  text-align: center;
  
  .progress-text {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }
  
  .progress-bar {
    width: 100%;
    height: 10px;
    background: var(--background-secondary);
    border-radius: 5px;
    overflow: hidden;
    
    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      border-radius: 5px;
      transition: width 0.4s ease;
    }
  }
}
```

**Angular Animation (Optionnel):**
```typescript
animations: [
  trigger('progressAnimation', [
    transition('* => *', [
      animate('400ms ease-out')
    ])
  ])
]
```

**Component Logic:**
```typescript
progress = { current: 0, total: 0, percentage: 0 };

ngOnInit() {
  this.subscriptions.add(
    this.passageService.getPassageState().subscribe(state => {
      this.progress = this.getProgress();
    })
  );
}
```

---

## Dependencies

- ✅ Story 3.6 complétée (PassageComponent structure)
- ✅ Story 3.2 complétée (PassageState avec currentTechniqueIndex et currentPassage)
- ✅ PassageService.getPassageState() disponible
- ✅ Support Randori dans le calcul (Story 3.2)

---

## Testing Checklist

- [ ] Test: Indicateur "X / Y" affiché
- [ ] Test: Format clair et lisible
- [ ] Test: Mise à jour automatique à chaque nouvelle technique
- [ ] Test: Barre de progression affichée
- [ ] Test: Calcul du pourcentage correct (X/Y * 100%)
- [ ] Test: Animation fluide de la barre
- [ ] Test: Indicateur visible mais non intrusif
- [ ] Test: Intégration avec PassageService
- [ ] Test: Gestion des cas limites (null, 0, 100%)
- [ ] Test: Randori inclus dans le total si activé

---

## Definition of Done

- ✅ Tous les Acceptance Criteria sont remplis
- ✅ Code compile sans erreurs
- ✅ Tests unitaires passent (couverture minimale 70%)
- ✅ Indicateur texte fonctionne
- ✅ Barre de progression fonctionne
- ✅ Animation fluide fonctionne
- ✅ Mise à jour automatique fonctionne
- ✅ Code review effectué
- ✅ Documentation du code (JSDoc) ajoutée

---
