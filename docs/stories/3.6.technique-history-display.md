# Story 3.6: Technique History Display

**Status:** Draft  
**Epic:** 3 - Passage Generation & Core Execution  
**Story Number:** 3.6  

---

## Story

**As a** user,  
**I want** voir l'historique de toutes les techniques énoncées,  
**so that** je peux me rappeler ce qui a déjà été fait.

---

## Acceptance Criteria

1. Un historique des techniques est affiché sur la page de passage
2. L'historique montre toutes les techniques déjà énoncées dans l'ordre
3. L'historique est affiché sous forme de liste déroulante, sidebar, ou section scrollable
4. Chaque entrée de l'historique montre : l'attaque, la technique, et la position
5. L'historique se met à jour automatiquement quand une nouvelle technique est annoncée
6. L'historique est visible mais non intrusif (ne distrait pas de la technique en cours)
7. Sur mobile, l'historique peut être masqué/affiché via un bouton

---

## Tasks / Subtasks

- [ ] **Task 1: Create History Display Section** (AC: 1, 3)
  - [ ] Créer la section/composant pour l'historique
  - [ ] Choisir le format (liste scrollable, sidebar, ou collapsible)
  - [ ] Intégrer dans PassageComponent template
  - [ ] Positionner de manière non intrusive

- [ ] **Task 2: Implement History List Structure** (AC: 2, 4)
  - [ ] Créer la structure de liste pour les techniques
  - [ ] Afficher chaque entrée avec attaque, technique, position
  - [ ] Maintenir l'ordre chronologique
  - [ ] Format de liste (ul/li, div, ou composant)

- [ ] **Task 3: Integrate with PassageService** (AC: 5)
  - [ ] Récupérer l'historique des techniques depuis PassageService
  - [ ] Écouter les changements d'état pour mettre à jour l'historique
  - [ ] Afficher les techniques déjà énoncées (index < currentTechniqueIndex)
  - [ ] Mettre à jour automatiquement lors de nouvelles techniques

- [ ] **Task 4: Implement History Entry Format** (AC: 4)
  - [ ] Format d'affichage pour chaque entrée (attaque, technique, position)
  - [ ] Hiérarchie visuelle claire
  - [ ] Styles CSS pour lisibilité
  - [ ] Optionnel: Numéro d'ordre ou timestamp

- [ ] **Task 5: Style History as Non-Intrusive** (AC: 6)
  - [ ] Positionner l'historique de manière non intrusive
  - [ ] Taille appropriée (pas trop grande, pas trop petite)
  - [ ] Couleurs discrètes mais lisibles
  - [ ] Ne pas distraire de la technique en cours

- [ ] **Task 6: Implement Mobile Toggle Button** (AC: 7)
  - [ ] Créer un bouton pour masquer/afficher l'historique sur mobile
  - [ ] Gérer l'état visible/masqué
  - [ ] Animation de transition (slide, fade)
  - [ ] Icône appropriée (chevron, menu, etc.)

- [ ] **Task 7: Implement Scrollable List** (AC: 3)
  - [ ] Rendre la liste scrollable si nécessaire
  - [ ] Gérer le scroll automatique vers le bas (optionnel)
  - [ ] Styles pour scrollbar (optionnel, utiliser style du navigateur ou custom)
  - [ ] Hauteur maximale pour éviter de prendre tout l'écran

- [ ] **Task 8: Create Unit Tests** (AC: 1-7)
  - [ ] Tester l'affichage de l'historique
  - [ ] Tester l'ordre des techniques
  - [ ] Tester le format des entrées (attaque, technique, position)
  - [ ] Tester la mise à jour automatique
  - [ ] Tester le bouton toggle sur mobile
  - [ ] Tester l'intégration avec PassageService

---

## Dev Notes

### Previous Story Insights

**Source:** Story 3.5 - Current Technique Display
- PassageComponent structure en place
- PassageService intégré
- Technique model disponible

**Source:** Story 3.2 - Passage State Management
- PassageState contient currentPassage avec liste de techniques
- currentTechniqueIndex disponible pour déterminer l'historique

### Technical Context

**Source:** [architecture/frontend-architecture.md](../../architecture/frontend-architecture.md)

**PassageComponent:**
- **Location:** `src/app/pages/passage/passage.ts`, `passage.html`, `passage.scss`
- **Dependencies:** PassageService pour l'historique

**History Logic:**
- Historique = techniques avec index < currentTechniqueIndex
- PassagesState.currentPassage.techniques contient toutes les techniques
- Filtrer pour obtenir seulement celles déjà énoncées

**Display Options:**
1. **Liste scrollable:** Section fixe avec scroll vertical
2. **Sidebar:** Panneau latéral (desktop), collapsible (mobile)
3. **Collapsible section:** Section qui s'ouvre/se ferme

**Mobile Considerations:**
- Espace limité sur mobile
- Bouton toggle pour masquer/afficher
- Historique masqué par défaut sur mobile (optionnel)

### Implementation Details

**History Data:**
```typescript
getHistory(): Technique[] {
  const state = this.passageService.getPassageState().value;
  if (!state.currentPassage) return [];
  
  return state.currentPassage.techniques.slice(0, state.currentTechniqueIndex);
}
```

**Template Structure:**
```html
<div class="history-section" [class.visible]="isHistoryVisible">
  <button class="history-toggle" (click)="toggleHistory()" *ngIf="isMobile">
    <span>{{ isHistoryVisible ? 'Masquer' : 'Historique' }}</span>
  </button>
  
  <div class="history-list" *ngIf="isHistoryVisible || !isMobile">
    <div class="history-item" *ngFor="let technique of history">
      <span class="history-position">{{ technique.position }}</span>
      <span class="history-attack">{{ technique.attack }}</span>
      <span class="history-technique">{{ technique.technique }}</span>
    </div>
  </div>
</div>
```

**Styles CSS:**
```scss
.history-section {
  position: fixed; // ou relative selon layout
  bottom: 1rem;
  right: 1rem;
  max-width: 300px;
  max-height: 40vh;
  background: var(--background-secondary);
  border-radius: 8px;
  padding: 1rem;
  overflow-y: auto;
  opacity: 0.9;
  
  @media (max-width: 768px) {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    max-height: 50vh;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    
    &.visible {
      transform: translateY(0);
    }
  }
}

.history-item {
  padding: 0.5rem;
  border-bottom: 1px solid var(--border-color);
  font-size: 0.9rem;
  
  .history-position {
    font-weight: 600;
    color: var(--text-secondary);
  }
  
  .history-technique {
    font-weight: bold;
    color: var(--text-primary);
  }
}
```

**Toggle Logic:**
```typescript
isHistoryVisible: boolean = false; // false sur mobile par défaut
isMobile: boolean = window.innerWidth < 768;

toggleHistory(): void {
  this.isHistoryVisible = !this.isHistoryVisible;
}

ngOnInit() {
  // Détecter mobile
  this.isMobile = window.innerWidth < 768;
  // Desktop: toujours visible, mobile: masqué par défaut
  if (!this.isMobile) {
    this.isHistoryVisible = true;
  }
}
```

---

## Dependencies

- ✅ Story 3.5 complétée (PassageComponent structure)
- ✅ Story 3.2 complétée (PassageState avec techniques et currentTechniqueIndex)
- ✅ PassageService.getPassageState() disponible
- ✅ Technique model défini

---

## Testing Checklist

- [ ] Test: Historique affiché sur la page de passage
- [ ] Test: Techniques affichées dans l'ordre chronologique
- [ ] Test: Format de liste approprié (scrollable/sidebar/collapsible)
- [ ] Test: Chaque entrée montre attaque, technique, position
- [ ] Test: Mise à jour automatique lors de nouvelles techniques
- [ ] Test: Historique non intrusif (ne distrait pas)
- [ ] Test: Bouton toggle sur mobile fonctionne
- [ ] Test: Intégration avec PassageService
- [ ] Test: Scroll fonctionne si liste longue

---

## Definition of Done

- ✅ Tous les Acceptance Criteria sont remplis
- ✅ Code compile sans erreurs
- ✅ Tests unitaires passent (couverture minimale 70%)
- ✅ Historique affiché correctement
- ✅ Mise à jour automatique fonctionne
- ✅ Bouton toggle mobile fonctionne
- ✅ Design non intrusif
- ✅ Code review effectué
- ✅ Documentation du code (JSDoc) ajoutée

---
