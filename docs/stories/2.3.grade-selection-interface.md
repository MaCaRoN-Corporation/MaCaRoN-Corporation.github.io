# Story 2.3: Grade Selection Interface

**Status:** Pending  
**Epic:** 2 - Data Management & Configuration  
**Story Number:** 2.3

---

## Story

**As a** user,  
**I want** to sélectionner le grade pour lequel je veux m'entraîner,  
**so that** l'application génère un passage approprié à mon niveau.

---

## Acceptance Criteria

1. La page de configuration (`/config`) affiche une section dédiée pour la sélection du grade
2. Les grades disponibles (6e Kyū à 5e Dan) sont affichés de manière claire et accessible
3. L'interface permet de sélectionner un grade (liste déroulante, cartes visuelles, ou boutons radio)
4. La sélection du grade est sauvegardée dans le composant ConfigComponent
5. Le grade sélectionné est validé (doit être dans la liste des grades disponibles via GradeService)
6. Un grade par défaut est sélectionné si aucun n'est choisi (ex: "6e Kyū")
7. L'interface est claire et intuitive pour la sélection
8. Le design est responsive et fonctionne sur mobile et desktop
9. La sélection du grade déclenche la mise à jour des filtres disponibles (positions, attaques, techniques)
10. Un indicateur visuel montre clairement le grade sélectionné

---

## Tasks / Subtasks

- [ ] **Task 1: Create Grade Selection Section in ConfigComponent** (AC: 1, 7)
  - [ ] Ajouter une section "Sélection du grade" dans le template HTML
  - [ ] Utiliser un titre clair (h2 ou h3)
  - [ ] Structurer avec une div ou section avec classe CSS appropriée

- [ ] **Task 2: Integrate GradeService to Get Available Grades** (AC: 2, 5)
  - [ ] Injecter GradeService dans ConfigComponent
  - [ ] Appeler getGrades() depuis GradeService pour obtenir la liste des grades
  - [ ] Stocker les grades dans une propriété du composant (grades: string[])
  - [ ] Gérer le cas où les données ne sont pas encore chargées (loading state)

- [ ] **Task 3: Implement Grade Selection UI** (AC: 3, 10)
  - [ ] Créer une interface de sélection (choisir entre: select dropdown, radio buttons, cards)
  - [ ] Recommandation: utiliser des cartes/boutons pour meilleure UX (mobile-friendly)
  - [ ] Afficher tous les grades disponibles de manière visuelle
  - [ ] Ajouter un indicateur visuel pour le grade sélectionné (border, background color, checkmark)

- [ ] **Task 4: Implement Grade Selection Logic** (AC: 4, 5, 6)
  - [ ] Créer une propriété selectedGrade: string | null dans le composant
  - [ ] Implémenter onGradeSelect(grade: string) méthode
  - [ ] Valider le grade sélectionné avec GradeService.validateGrade()
  - [ ] Définir "6e Kyū" comme valeur par défaut si aucune sélection
  - [ ] Sauvegarder la sélection dans la propriété du composant

- [ ] **Task 5: Handle Grade Change and Update Filters** (AC: 9)
  - [ ] Écouter les changements de grade sélectionné
  - [ ] Quand le grade change, réinitialiser/mettre à jour les filtres disponibles
  - [ ] Utiliser GradeService pour obtenir les nouvelles positions/attaques disponibles
  - [ ] Désélectionner les filtres qui ne sont plus valides pour le nouveau grade

- [ ] **Task 6: Implement Responsive Design** (AC: 8)
  - [ ] Créer des styles CSS/SCSS pour mobile (une colonne)
  - [ ] Créer des styles pour desktop (grille ou layout adapté)
  - [ ] Utiliser media queries pour adapter l'affichage
  - [ ] Tester sur différentes tailles d'écran

- [ ] **Task 7: Add Visual Feedback** (AC: 10, 7)
  - [ ] Style pour le grade sélectionné (ex: border accent color, background highlight)
  - [ ] Style pour les grades non sélectionnés (état normal)
  - [ ] Style pour hover/focus (accessibilité)
  - [ ] Utiliser les variables CSS du thème pour la cohérence visuelle

- [ ] **Task 8: Handle Loading State** (AC: 2)
  - [ ] Afficher un indicateur de chargement pendant le chargement des données
  - [ ] Désactiver la sélection tant que les données ne sont pas chargées
  - [ ] Utiliser le loading state du GradeService

- [ ] **Task 9: Add Accessibility Features** (AC: 7)
  - [ ] Ajouter des labels appropriés pour les contrôles
  - [ ] Assurer la navigation au clavier (tab, enter, espace)
  - [ ] Ajouter aria-label ou aria-labelledby si nécessaire
  - [ ] Tester avec un lecteur d'écran

- [ ] **Task 10: Create Unit Tests** (AC: 1-10)
  - [ ] Tester l'affichage de la section grade selection
  - [ ] Tester la sélection d'un grade
  - [ ] Tester la validation du grade
  - [ ] Tester le grade par défaut
  - [ ] Tester la mise à jour des filtres lors du changement de grade
  - [ ] Tester le loading state
  - [ ] Tester le responsive design (si possible)

---

## Dev Notes

### Previous Story Insights

**Source:** Story 2.1 - JSON Data Loading Service
- GradeService charge les données JSON et expose loadNomenclature()

**Source:** Story 2.2 - JSON Parsing and Data Structure
- GradeService.getGrades() retourne la liste des grades disponibles
- GradeService.validateGrade() valide si un grade existe

**Source:** Story 1.2 - Routing Setup and Navigation
- ConfigComponent existe déjà avec route `/config`
- Structure de base du composant est en place

### Technical Context

**Source:** [architecture/components.md](../../architecture/components.md)

**ConfigComponent:**
- **Location:** `src/app/pages/config/config.ts` et `config.html`
- **Responsibility:** Page de configuration complète pour générer un passage
- **Dependencies:** GradeService pour obtenir les grades et valider

**Grades Available (from nomenclature.json):**
- 6e Kyū, 5e Kyū, 4e Kyū, 3e Kyū, 2e Kyū, 1er Kyū
- 1er Dan, 2e Dan, 3e Dan, 4e Dan, 5e Dan

**UI/UX Considerations:**
- Utiliser des cartes/boutons plutôt qu'un select pour meilleure UX mobile
- Organiser les grades par groupes (Kyū vs Dan) si visuellement utile
- Utiliser les couleurs du thème pour la cohérence visuelle

**Responsive Design:**
- Mobile: Une colonne, cartes empilées verticalement
- Desktop: Grille 2-3 colonnes ou layout horizontal

**Default Grade:**
- "6e Kyū" est le grade de départ logique (premier grade)

### Implementation Details

**Component Structure:**
```typescript
export class ConfigComponent {
  grades: string[] = [];
  selectedGrade: string = '6e Kyū'; // Default
  isLoadingGrades: boolean = false;

  constructor(private gradeService: GradeService) {}

  ngOnInit() {
    this.loadGrades();
  }

  onGradeSelect(grade: string) {
    if (this.gradeService.validateGrade(grade)) {
      this.selectedGrade = grade;
      this.updateFiltersForGrade(grade);
    }
  }
}
```

**Template Structure:**
```html
<section class="grade-selection">
  <h2>Sélection du grade</h2>
  <div class="grades-grid" *ngIf="!isLoadingGrades">
    <button 
      *ngFor="let grade of grades"
      [class.selected]="selectedGrade === grade"
      (click)="onGradeSelect(grade)">
      {{ grade }}
    </button>
  </div>
  <div *ngIf="isLoadingGrades">Chargement des grades...</div>
</section>
```

**Styling:**
- Utiliser les variables CSS du thème (--primary-color, --accent-color)
- Border-radius pour les cartes/boutons
- Transition pour les changements d'état
- Responsive avec media queries

---

## Dependencies

- ✅ Story 2.1 complétée (chargement données)
- ✅ Story 2.2 complétée (getGrades(), validateGrade())
- ✅ ConfigComponent existe (Story 1.2)
- ✅ GradeService injectable

---

## Testing Checklist

- [ ] Test: Section grade selection s'affiche dans le template
- [ ] Test: Liste des grades est chargée depuis GradeService
- [ ] Test: Grade par défaut est "6e Kyū"
- [ ] Test: Sélection d'un grade fonctionne
- [ ] Test: Validation du grade fonctionne
- [ ] Test: Filtres sont mis à jour lors du changement de grade
- [ ] Test: Loading state s'affiche pendant le chargement
- [ ] Test: Responsive design fonctionne (mobile/desktop)
- [ ] Test: Accessibilité (navigation clavier, labels)
- [ ] Test: Styles visuels appliqués correctement

---

## Definition of Done

- ✅ Tous les Acceptance Criteria sont remplis
- ✅ Code compile sans erreurs
- ✅ Tests unitaires passent (couverture minimale 70%)
- ✅ Interface responsive fonctionne
- ✅ Accessibilité de base respectée
- ✅ Design cohérent avec le thème de l'application
- ✅ Code review effectué
- ✅ Documentation du code (JSDoc) ajoutée
