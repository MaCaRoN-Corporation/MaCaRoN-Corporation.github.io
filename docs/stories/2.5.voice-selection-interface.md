# Story 2.5: Voice Selection Interface

**Status:** Pending  
**Epic:** 2 - Data Management & Configuration  
**Story Number:** 2.5

---

## Story

**As a** user,  
**I want** to choisir le type de voix (masculin ou féminin) pour les annonces,  
**so that** je peux personnaliser l'expérience audio selon mes préférences.

---

## Acceptance Criteria

1. La page de configuration affiche une section pour la sélection de la voix
2. Deux options sont disponibles : "Masculin" et "Féminin" (boutons radio ou toggle)
3. La sélection est sauvegardée dans le SettingsService (persistée)
4. La valeur par défaut est "Masculin" si aucune préférence n'est sauvegardée
5. La sélection est persistée dans localStorage via le SettingsService
6. L'interface est claire et intuitive
7. Le design est cohérent avec le reste de l'application (thème)
8. Le design est responsive et fonctionne sur mobile et desktop
9. La sélection est synchronisée avec SettingsService (si déjà configurée ailleurs)
10. Un indicateur visuel montre clairement l'option sélectionnée

---

## Tasks / Subtasks

- [ ] **Task 1: Create Voice Selection Section** (AC: 1, 6)
  - [ ] Ajouter une section "Sélection de la voix" dans le template ConfigComponent
  - [ ] Utiliser un titre clair (h2 ou h3)
  - [ ] Structurer avec des options claires

- [ ] **Task 2: Integrate SettingsService** (AC: 3, 4, 5, 9)
  - [ ] Injecter SettingsService dans ConfigComponent
  - [ ] Charger la préférence de voix existante depuis SettingsService
  - [ ] Créer une propriété selectedVoice: 'masculin' | 'féminin' dans le composant
  - [ ] Initialiser avec la valeur du SettingsService ou 'masculin' par défaut
  - [ ] Synchroniser avec SettingsService lors des changements

- [ ] **Task 3: Implement Voice Selection UI** (AC: 2, 10)
  - [ ] Créer une interface avec deux options (radio buttons ou toggle buttons)
  - [ ] Recommandation: utiliser des boutons toggle pour meilleure UX
  - [ ] Afficher "Masculin" et "Féminin" clairement
  - [ ] Ajouter un indicateur visuel pour l'option sélectionnée (background, border, checkmark)

- [ ] **Task 4: Implement Voice Selection Logic** (AC: 3, 9)
  - [ ] Créer une méthode onVoiceChange(voice: 'masculin' | 'féminin')
  - [ ] Mettre à jour selectedVoice dans le composant
  - [ ] Appeler SettingsService.updateSettings() pour sauvegarder
  - [ ] Utiliser SettingsService.applyVoice() si la méthode existe

- [ ] **Task 5: Handle Default Value** (AC: 4)
  - [ ] Vérifier si une préférence existe dans SettingsService
  - [ ] Si oui, utiliser cette préférence
  - [ ] Si non, définir 'masculin' comme valeur par défaut
  - [ ] Sauvegarder la valeur par défaut dans SettingsService si nécessaire

- [ ] **Task 6: Implement Persistence** (AC: 5)
  - [ ] S'assurer que SettingsService sauvegarde dans localStorage
  - [ ] Vérifier que la valeur persiste après rechargement de la page
  - [ ] Tester la persistance

- [ ] **Task 7: Add Visual Feedback** (AC: 10, 7)
  - [ ] Style pour l'option sélectionnée (ex: primary color, border)
  - [ ] Style pour les options non sélectionnées (état normal)
  - [ ] Style pour hover/focus (accessibilité)
  - [ ] Utiliser les variables CSS du thème pour la cohérence

- [ ] **Task 8: Implement Responsive Design** (AC: 8)
  - [ ] Adapter le layout pour mobile (boutons empilés ou horizontaux selon espace)
  - [ ] Adapter le layout pour desktop
  - [ ] Utiliser media queries si nécessaire
  - [ ] Tester sur différentes tailles d'écran

- [ ] **Task 9: Add Accessibility Features** (AC: 6)
  - [ ] Ajouter des labels appropriés
  - [ ] Utiliser des radio buttons HTML natifs ou des boutons avec role="radio"
  - [ ] Assurer la navigation au clavier (tab, flèches, espace)
  - [ ] Ajouter aria-label ou aria-labelledby
  - [ ] Tester avec un lecteur d'écran

- [ ] **Task 10: Sync with Existing Settings** (AC: 9)
  - [ ] Charger la voix depuis SettingsService.getSettings() au ngOnInit
  - [ ] S'assurer que si l'utilisateur change la voix ailleurs (ex: Settings page), la config page se met à jour
  - [ ] Utiliser un Observable pour écouter les changements si nécessaire

- [ ] **Task 11: Create Unit Tests** (AC: 1-10)
  - [ ] Tester l'affichage de la section
  - [ ] Tester le chargement de la préférence depuis SettingsService
  - [ ] Tester la sélection d'une voix
  - [ ] Tester la sauvegarde dans SettingsService
  - [ ] Tester la valeur par défaut
  - [ ] Tester la persistance
  - [ ] Tester la synchronisation

---

## Dev Notes

### Previous Story Insights

**Source:** Story 1.5 - Settings Service LocalStorage
- SettingsService est complet avec méthodes pour sauvegarder/charger les settings
- SettingsService contient déjà la propriété `voice: 'masculin' | 'féminin'` dans UserSettings
- SettingsService utilise localStorage pour la persistance
- Méthodes disponibles: getSettings(), updateSettings(), saveSettings()

**Source:** Story 2.3 - Grade Selection Interface
- ConfigComponent a déjà une structure de base pour les sections

### Technical Context

**Source:** [architecture/components.md](../../architecture/components.md)

**SettingsService:**
- **Location:** `src/app/services/settings.service.ts`
- **Responsibility:** Gestion des réglages utilisateur avec persistance localStorage
- **UserSettings Interface:** Contient `voice: 'masculin' | 'féminin'`

**ConfigComponent:**
- **Location:** `src/app/pages/config/config.ts` et `config.html`
- **Dependency:** SettingsService pour la persistance de la voix

**UI/UX Considerations:**
- Utiliser des boutons toggle plutôt que des radio buttons pour meilleure UX visuelle
- Ou utiliser des radio buttons HTML natifs pour meilleure accessibilité
- Compromis: boutons stylisés avec role="radio" pour les deux avantages

**Default Value:**
- "Masculin" est la valeur par défaut selon DEFAULT_SETTINGS dans SettingsService

**Persistence:**
- La voix est déjà dans UserSettings, donc elle sera automatiquement persistée via SettingsService

### Implementation Details

**Component Structure:**
```typescript
export class ConfigComponent {
  selectedVoice: 'masculin' | 'féminin' = 'masculin';

  constructor(private settingsService: SettingsService) {}

  ngOnInit() {
    // Charger la préférence depuis SettingsService
    const settings = this.settingsService.getSettings();
    this.selectedVoice = settings.voice;
  }

  onVoiceChange(voice: 'masculin' | 'féminin') {
    this.selectedVoice = voice;
    // Sauvegarder dans SettingsService
    this.settingsService.updateSettings({ voice });
  }
}
```

**Template Structure (Option 1: Radio Buttons):**
```html
<section class="voice-selection">
  <h2>Sélection de la voix</h2>
  <div class="voice-options">
    <label class="voice-option">
      <input 
        type="radio" 
        name="voice"
        value="masculin"
        [(ngModel)]="selectedVoice"
        (change)="onVoiceChange('masculin')">
      <span>Masculin</span>
    </label>
    <label class="voice-option">
      <input 
        type="radio" 
        name="voice"
        value="féminin"
        [(ngModel)]="selectedVoice"
        (change)="onVoiceChange('féminin')">
      <span>Féminin</span>
    </label>
  </div>
</section>
```

**Template Structure (Option 2: Toggle Buttons):**
```html
<section class="voice-selection">
  <h2>Sélection de la voix</h2>
  <div class="voice-toggle-group">
    <button 
      type="button"
      class="toggle-button"
      [class.active]="selectedVoice === 'masculin'"
      (click)="onVoiceChange('masculin')"
      role="radio"
      [attr.aria-checked]="selectedVoice === 'masculin'">
      Masculin
    </button>
    <button 
      type="button"
      class="toggle-button"
      [class.active]="selectedVoice === 'féminin'"
      (click)="onVoiceChange('féminin')"
      role="radio"
      [attr.aria-checked]="selectedVoice === 'féminin'">
      Féminin
    </button>
  </div>
</section>
```

**Styling:**
- Utiliser les variables CSS du thème (--primary-color, --accent-color)
- Style pour les boutons toggle (border-radius, padding, transition)
- Style pour l'état actif (background, border, color)
- Responsive avec media queries

---

## Dependencies

- ✅ SettingsService existe et fonctionne (Story 1.5)
- ✅ UserSettings interface contient voice property
- ✅ ConfigComponent existe (Story 1.2)

---

## Testing Checklist

- [ ] Test: Section voice selection s'affiche
- [ ] Test: Options "Masculin" et "Féminin" sont disponibles
- [ ] Test: Valeur par défaut est "Masculin"
- [ ] Test: Chargement de la préférence depuis SettingsService fonctionne
- [ ] Test: Sélection d'une voix fonctionne
- [ ] Test: Sauvegarde dans SettingsService fonctionne
- [ ] Test: Persistance dans localStorage fonctionne
- [ ] Test: Synchronisation avec SettingsService fonctionne
- [ ] Test: Responsive design fonctionne
- [ ] Test: Accessibilité (navigation clavier, labels)

---

## Definition of Done

- ✅ Tous les Acceptance Criteria sont remplis
- ✅ Code compile sans erreurs
- ✅ Tests unitaires passent (couverture minimale 70%)
- ✅ Intégration SettingsService fonctionne
- ✅ Persistance fonctionne
- ✅ Interface responsive
- ✅ Accessibilité de base respectée
- ✅ Code review effectué
- ✅ Documentation du code (JSDoc) ajoutée
