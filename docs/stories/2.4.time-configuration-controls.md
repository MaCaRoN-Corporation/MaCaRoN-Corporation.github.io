# Story 2.4: Time Configuration Controls

**Status:** Pending  
**Epic:** 2 - Data Management & Configuration  
**Story Number:** 2.4

---

## Story

**As a** user,  
**I want** to configurer le temps entre chaque technique et la durée totale du passage,  
**so that** je peux adapter le rythme de l'entraînement à mes besoins.

---

## Acceptance Criteria

1. La page de configuration affiche une section "Configuration du temps"
2. Des contrôles sont disponibles pour configurer le temps entre techniques (en secondes)
3. Des contrôles sont disponibles pour configurer la durée totale du passage (en minutes)
4. Les contrôles utilisent des sliders ou des inputs numériques avec validation
5. Des valeurs par défaut sensées sont proposées (ex: 5 secondes entre techniques, 10 minutes total)
6. Les valeurs sont validées (minimum/maximum raisonnables)
7. Les valeurs configurées sont sauvegardées dans le composant ConfigComponent
8. Un aperçu ou indication visuelle montre l'impact des réglages (nombre estimé de techniques)
9. L'interface est claire et intuitive
10. Le design est responsive et fonctionne sur mobile et desktop

---

## Tasks / Subtasks

- [ ] **Task 1: Create Time Configuration Section** (AC: 1, 9)
  - [ ] Ajouter une section "Configuration du temps" dans le template ConfigComponent
  - [ ] Utiliser un titre clair (h2 ou h3)
  - [ ] Structurer avec des sous-sections pour chaque paramètre

- [ ] **Task 2: Implement Time Between Techniques Control** (AC: 2, 4, 5, 6, 7)
  - [ ] Créer un contrôle (slider + input numérique ou input seul avec validation)
  - [ ] Définir la valeur par défaut: 5 secondes
  - [ ] Définir les limites: minimum 3 secondes, maximum 30 secondes
  - [ ] Créer une propriété timeBetweenTechniques: number dans le composant
  - [ ] Implémenter la validation (min/max)
  - [ ] Sauvegarder la valeur dans le composant

- [ ] **Task 3: Implement Total Duration Control** (AC: 3, 4, 5, 6, 7)
  - [ ] Créer un contrôle (slider + input numérique ou input seul avec validation)
  - [ ] Définir la valeur par défaut: 10 minutes
  - [ ] Définir les limites: minimum 5 minutes, maximum 60 minutes
  - [ ] Créer une propriété totalDuration: number dans le composant (en minutes)
  - [ ] Implémenter la validation (min/max)
  - [ ] Sauvegarder la valeur dans le composant

- [ ] **Task 4: Implement Validation Logic** (AC: 6)
  - [ ] Créer des méthodes de validation pour chaque paramètre
  - [ ] Afficher des messages d'erreur si les valeurs sont hors limites
  - [ ] Empêcher la soumission si les valeurs sont invalides
  - [ ] Utiliser des Validators Angular si nécessaire (Reactive Forms)

- [ ] **Task 5: Implement Visual Preview/Calculation** (AC: 8)
  - [ ] Calculer le nombre estimé de techniques: totalDuration (en secondes) / timeBetweenTechniques
  - [ ] Afficher un aperçu: "Environ X techniques seront annoncées"
  - [ ] Mettre à jour l'aperçu en temps réel lors des changements
  - [ ] Formater l'affichage de manière claire

- [ ] **Task 6: Choose UI Components** (AC: 4, 10)
  - [ ] Décider: slider + input ou input seul avec +/- buttons
  - [ ] Recommandation: input numérique avec boutons +/- pour meilleure précision mobile
  - [ ] Alternative: slider pour desktop, input pour mobile
  - [ ] Assurer que les contrôles sont accessibles (labels, aria-*)

- [ ] **Task 7: Implement Responsive Design** (AC: 10)
  - [ ] Adapter le layout pour mobile (une colonne)
  - [ ] Adapter le layout pour desktop (deux colonnes si slider)
  - [ ] Utiliser media queries
  - [ ] Tester sur différentes tailles d'écran

- [ ] **Task 8: Add Input Formatting** (AC: 9)
  - [ ] Formater l'affichage des valeurs (ex: "5 s" pour secondes, "10 min" pour minutes)
  - [ ] Afficher les unités clairement (secondes/minutes)
  - [ ] Utiliser des labels descriptifs

- [ ] **Task 9: Implement Two-Way Binding** (AC: 7)
  - [ ] Utiliser [(ngModel)] ou Reactive Forms pour le binding
  - [ ] S'assurer que les changements sont immédiatement reflétés
  - [ ] Prévoir la synchronisation entre slider et input si les deux sont utilisés

- [ ] **Task 10: Add Accessibility Features** (AC: 9)
  - [ ] Ajouter des labels appropriés
  - [ ] Ajouter aria-label ou aria-labelledby
  - [ ] Assurer la navigation au clavier
  - [ ] Tester avec un lecteur d'écran

- [ ] **Task 11: Create Unit Tests** (AC: 1-10)
  - [ ] Tester l'affichage de la section
  - [ ] Tester les valeurs par défaut
  - [ ] Tester la validation (min/max)
  - [ ] Tester le calcul du nombre de techniques
  - [ ] Tester la sauvegarde des valeurs
  - [ ] Tester le responsive design (si possible)

---

## Dev Notes

### Previous Story Insights

**Source:** Story 2.3 - Grade Selection Interface
- ConfigComponent a déjà une structure de base pour les sections

**Source:** Story 1.5 - Settings Service LocalStorage
- SettingsService existe pour la persistance, mais les réglages de temps peuvent être spécifiques au passage (pas forcément persistés)

### Technical Context

**Source:** [architecture/components.md](../../architecture/components.md)

**ConfigComponent:**
- **Location:** `src/app/pages/config/config.ts` et `config.html`
- **Responsibility:** Configuration complète avant génération du passage

**Passage Model:**
- Le modèle Passage inclut `duration: number` (durée totale en minutes)
- Le modèle Passage inclut `timeBetweenTechniques: number` (en secondes)

**UI/UX Considerations:**
- Utiliser des inputs numériques avec boutons +/- pour meilleure précision
- Afficher les unités clairement (s, min)
- Aperçu visuel pour aider l'utilisateur à comprendre l'impact

**Default Values:**
- Time between techniques: 5 secondes (raisonnable pour suivre les annonces)
- Total duration: 10 minutes (durée standard pour un passage)

**Validation Rules:**
- Time between techniques: 3-30 secondes (minimum pour comprendre, maximum pour ne pas être trop lent)
- Total duration: 5-60 minutes (minimum pour un passage utile, maximum raisonnable)

### Implementation Details

**Component Structure:**
```typescript
export class ConfigComponent {
  timeBetweenTechniques: number = 5; // secondes, default
  totalDuration: number = 10; // minutes, default

  // Validation constants
  readonly MIN_TIME_BETWEEN = 3;
  readonly MAX_TIME_BETWEEN = 30;
  readonly MIN_DURATION = 5;
  readonly MAX_DURATION = 60;

  // Calcul du nombre estimé de techniques
  get estimatedTechniqueCount(): number {
    const totalSeconds = this.totalDuration * 60;
    return Math.floor(totalSeconds / this.timeBetweenTechniques);
  }

  validateTimeBetween(value: number): boolean {
    return value >= this.MIN_TIME_BETWEEN && value <= this.MAX_TIME_BETWEEN;
  }

  validateDuration(value: number): boolean {
    return value >= this.MIN_DURATION && value <= this.MAX_DURATION;
  }
}
```

**Template Structure:**
```html
<section class="time-configuration">
  <h2>Configuration du temps</h2>
  
  <div class="time-control">
    <label for="time-between">Temps entre techniques</label>
    <div class="input-group">
      <button (click)="decrementTimeBetween()" [disabled]="timeBetweenTechniques <= MIN_TIME_BETWEEN">-</button>
      <input 
        type="number" 
        id="time-between"
        [(ngModel)]="timeBetweenTechniques"
        [min]="MIN_TIME_BETWEEN"
        [max]="MAX_TIME_BETWEEN"
        (blur)="validateTimeBetweenInput()">
      <span>secondes</span>
      <button (click)="incrementTimeBetween()" [disabled]="timeBetweenTechniques >= MAX_TIME_BETWEEN">+</button>
    </div>
  </div>

  <div class="time-control">
    <label for="duration">Durée totale</label>
    <div class="input-group">
      <button (click)="decrementDuration()" [disabled]="totalDuration <= MIN_DURATION">-</button>
      <input 
        type="number" 
        id="duration"
        [(ngModel)]="totalDuration"
        [min]="MIN_DURATION"
        [max]="MAX_DURATION"
        (blur)="validateDurationInput()">
      <span>minutes</span>
      <button (click)="incrementDuration()" [disabled]="totalDuration >= MAX_DURATION">+</button>
    </div>
  </div>

  <div class="preview">
    <p>Environ <strong>{{ estimatedTechniqueCount }}</strong> techniques seront annoncées</p>
  </div>
</section>
```

**Styling:**
- Utiliser les variables CSS du thème
- Style pour les inputs numériques (border, padding)
- Style pour les boutons +/-
- Style pour l'aperçu (mise en évidence)
- Responsive avec media queries

---

## Dependencies

- ✅ ConfigComponent existe (Story 1.2)
- ✅ Passage model défini avec duration et timeBetweenTechniques

---

## Testing Checklist

- [ ] Test: Section time configuration s'affiche
- [ ] Test: Valeurs par défaut sont correctes (5s, 10min)
- [ ] Test: Validation min/max fonctionne
- [ ] Test: Calcul du nombre de techniques est correct
- [ ] Test: Aperçu se met à jour lors des changements
- [ ] Test: Boutons +/- fonctionnent
- [ ] Test: Responsive design fonctionne
- [ ] Test: Accessibilité (labels, navigation clavier)
- [ ] Test: Messages d'erreur s'affichent si valeurs invalides

---

## Definition of Done

- ✅ Tous les Acceptance Criteria sont remplis
- ✅ Code compile sans erreurs
- ✅ Tests unitaires passent (couverture minimale 70%)
- ✅ Validation fonctionne correctement
- ✅ Aperçu/calcul fonctionne
- ✅ Interface responsive
- ✅ Accessibilité de base respectée
- ✅ Code review effectué
- ✅ Documentation du code (JSDoc) ajoutée
