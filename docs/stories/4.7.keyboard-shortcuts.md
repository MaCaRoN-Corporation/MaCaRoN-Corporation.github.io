# Story 4.7: Keyboard Shortcuts

**Status:** Draft  
**Epic:** 4 - Audio System & User Controls  
**Story Number:** 4.7  

---

## Story

**As a** user,  
**I want** utiliser des raccourcis clavier pour contrôler le passage,  
**so that** je peux interagir rapidement sans utiliser la souris.

---

## Acceptance Criteria

**Raccourcis sur la page de passage (`/passage`):**
1. Le raccourci **Espace** met en pause/reprend le passage (bouton UI déjà fait, raccourci à ajouter)
2. Le raccourci **Entrée** répète l'audio de la dernière technique (dépend de Story 4.5)
3. Le raccourci **Flèche droite** passe à la technique suivante (skip la technique en cours)
4. Les raccourcis fonctionnent uniquement quand la page de passage est active
5. Les raccourcis ne sont pas interceptés par d'autres éléments de la page
6. Un indicateur visuel ou aide-mémoire montre les raccourcis disponibles (optionnel)
7. Les raccourcis fonctionnent même en mode plein écran (Story 4.6 déjà fait)

**Raccourcis sur la page d'accueil (`/`):**
8. Le raccourci **Flèche gauche** navigue vers le type de passage précédent dans le carrousel
9. Le raccourci **Flèche droite** navigue vers le type de passage suivant dans le carrousel
10. Les raccourcis fonctionnent uniquement quand la page d'accueil est active
11. Les raccourcis ne sont pas interceptés par d'autres éléments de la page

---

## Tasks / Subtasks

- [ ] **Task 1: Implement Space Shortcut for Pause/Resume** (AC: 1, 4, 5, 7)
  - [ ] Ajouter `@HostListener('document:keydown.space')` dans PassageComponent
  - [ ] Empêcher le comportement par défaut (scroll de page)
  - [ ] Appeler `togglePause()` quand Espace est pressé
  - [ ] Vérifier que le raccourci fonctionne uniquement sur la page passage
  - [ ] Tester en mode plein écran

- [ ] **Task 2: Implement Enter Shortcut for Repeat** (AC: 2, 4, 5, 7)
  - [ ] Ajouter `@HostListener('document:keydown.enter')` dans PassageComponent
  - [ ] Empêcher le comportement par défaut (soumission de formulaire)
  - [ ] Appeler `repeatLastTechnique()` quand Entrée est pressé
  - [ ] Vérifier que le raccourci fonctionne uniquement sur la page passage
  - [ ] Tester en mode plein écran

- [ ] **Task 3: Implement Arrow Right Shortcut for Skip** (AC: 3, 4, 5, 7)
  - [ ] Ajouter `@HostListener('document:keydown.arrowright')` dans PassageComponent
  - [ ] Empêcher le comportement par défaut (navigation)
  - [ ] Appeler `skipTechnique()` quand Flèche droite est pressée
  - [ ] Vérifier que le raccourci fonctionne uniquement sur la page passage
  - [ ] Tester en mode plein écran

- [ ] **Task 4: Implement Arrow Left/Right for Home Carousel** (AC: 8, 9, 10, 11)
  - [ ] Ajouter `@HostListener('document:keydown.arrowleft')` dans HomeComponent
  - [ ] Ajouter `@HostListener('document:keydown.arrowright')` dans HomeComponent
  - [ ] Naviguer vers le type de passage précédent/suivant dans le carrousel
  - [ ] Vérifier que les raccourcis fonctionnent uniquement sur la page d'accueil
  - [ ] Empêcher le comportement par défaut (scroll horizontal)

- [ ] **Task 5: Prevent Shortcut Conflicts** (AC: 5, 11)
  - [ ] Vérifier que les raccourcis ne sont pas interceptés par les inputs/textarea
  - [ ] Désactiver les raccourcis si l'utilisateur est en train de taper dans un champ
  - [ ] Tester avec différents éléments focusables

- [ ] **Task 6: Add Visual Help (Optional)** (AC: 6)
  - [ ] Créer un composant ou tooltip montrant les raccourcis disponibles
  - [ ] Afficher l'aide sur demande (bouton "?" ou raccourci)
  - [ ] Design cohérent avec l'interface

- [ ] **Task 7: Test Keyboard Shortcuts** (AC: 1-11)
  - [ ] Tester tous les raccourcis sur la page passage
  - [ ] Tester tous les raccourcis sur la page d'accueil
  - [ ] Tester que les raccourcis ne fonctionnent pas sur d'autres pages
  - [ ] Tester en mode plein écran
  - [ ] Tester avec différents navigateurs
  - [ ] Tester les conflits avec les champs de saisie

---

## Dev Notes

### Previous Story Insights

**Source:** Story 4.4 - Pause and Resume Controls
- `togglePause()` existe déjà dans PassageComponent
- Le bouton UI pause/resume est implémenté

**Source:** Story 4.5 - Repeat Last Technique Control
- `repeatLastTechnique()` sera implémenté dans PassageComponent
- Le bouton UI répéter sera ajouté

**Source:** Story 3.3 - Passage Page Layout and Timer
- `skipTechnique()` existe déjà dans PassageComponent
- Le bouton skip est déjà implémenté

**Source:** Story 2.9 - Configuration Page Complete Integration
- HomeComponent gère le carrousel des types de passage
- Les méthodes de navigation du carrousel existent

### Technical Context

**Source:** [architecture/components.md](../../architecture/components.md)
- Les raccourcis clavier doivent être gérés au niveau des composants
- Utiliser `@HostListener` d'Angular pour écouter les événements clavier

**Angular HostListener:**
- `@HostListener('document:keydown.space')` pour écouter Espace
- `@HostListener('document:keydown.enter')` pour écouter Entrée
- `@HostListener('document:keydown.arrowright')` pour écouter Flèche droite
- Empêcher le comportement par défaut avec `event.preventDefault()`

**Route Detection:**
- Utiliser `Router` pour détecter la route active
- Ou utiliser `@HostListener` uniquement quand le composant est actif (déjà géré par Angular)

**Prevent Conflicts:**
- Vérifier `event.target` pour s'assurer qu'on n'est pas dans un input/textarea
- Exemple : `if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) return;`

### Testing

**Test file location:**
- `src/app/pages/passage/passage.spec.ts` (pour PassageComponent)
- `src/app/pages/home/home.spec.ts` (pour HomeComponent)

**Test standards:**
- Tester que les raccourcis déclenchent les bonnes méthodes
- Tester que `preventDefault()` est appelé
- Tester que les raccourcis ne fonctionnent pas sur d'autres pages
- Tester les conflits avec les champs de saisie
- Utiliser `KeyboardEvent` pour simuler les touches

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-13 | 1.0 | Création initiale de la story | SM |

---

## Dev Agent Record

### Agent Model Used
_À remplir par le dev agent_

### Completion Notes List
_À remplir par le dev agent_

### File List
_À remplir par le dev agent_

---

## QA Results
_À remplir par le QA agent_
