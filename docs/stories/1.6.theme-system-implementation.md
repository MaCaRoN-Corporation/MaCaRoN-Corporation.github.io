# Story 1.6: Theme System Implementation

**Status:** Draft  
**Epic:** 1 - Foundation & Project Setup  
**Story Number:** 1.6

---

## Story

**As a** user,  
**I want** pouvoir choisir entre un thème clair et sombre,  
**so that** je peux adapter l'interface à mes préférences visuelles.

---

## Acceptance Criteria

1. Un système de thèmes est implémenté utilisant CSS Variables
2. Les thèmes clair et sombre sont définis avec des couleurs appropriées
3. Le thème est appliqué globalement à l'application via une classe CSS sur le body ou un élément racine
4. Le SettingsService gère le thème actuel et sa persistance
5. Un toggle ou sélecteur de thème est disponible (peut être dans la navigation ou page de réglages)
6. Le changement de thème est appliqué immédiatement sans rechargement de page
7. Le thème par défaut est "clair" si aucun n'est sauvegardé
8. Les transitions entre thèmes sont fluides (CSS transitions)

---

## Tasks / Subtasks

- [ ] **Task 1: Create CSS Variables for Themes** (AC: 1, 2)
  - [ ] Créer `src/styles/_variables.scss` pour définir les CSS Variables
  - [ ] Définir les variables pour le thème clair :
    - Couleurs de fond (background, surface)
    - Couleurs de texte (primary, secondary)
    - Couleurs d'accent (primary, secondary)
    - Couleurs de bordure
  - [ ] Définir les variables pour le thème sombre (mêmes variables avec valeurs différentes)
  - [ ] Utiliser des noms de variables descriptifs (ex: `--bg-primary`, `--text-primary`)

- [ ] **Task 2: Create Theme Definitions** (AC: 1, 2)
  - [ ] Créer `src/styles/_themes.scss` pour définir les classes de thème
  - [ ] Créer la classe `.theme-clair` avec les variables du thème clair
  - [ ] Créer la classe `.theme-sombre` avec les variables du thème sombre
  - [ ] Appliquer les transitions CSS pour les changements de thème (AC: 8)
  - [ ] Importer `_variables.scss` dans `_themes.scss`

- [ ] **Task 3: Apply Theme to Root Element** (AC: 3)
  - [ ] Modifier `app.component.ts` ou le composant racine pour appliquer la classe de thème
  - [ ] Appliquer la classe sur `<body>` ou un élément racine (ex: `<div class="app-root">`)
  - [ ] S'assurer que le thème est appliqué dès le chargement de l'application
  - [ ] Importer `_themes.scss` dans `styles.scss` global

- [ ] **Task 4: Integrate SettingsService with Theme** (AC: 4, 7)
  - [ ] Compléter la méthode `applyTheme(theme: 'clair' | 'sombre'): void` dans SettingsService
  - [ ] La méthode doit :
    - Mettre à jour la classe sur l'élément racine
    - Sauvegarder le thème dans les réglages (via `updateSettings`)
    - Notifier les observateurs via BehaviorSubject
  - [ ] Charger le thème sauvegardé au démarrage (déjà fait dans Story 1.5)
  - [ ] Appliquer le thème par défaut "clair" si aucun n'est sauvegardé

- [ ] **Task 5: Create Theme Toggle Component** (AC: 5, 6)
  - [ ] Créer un composant de toggle de thème (peut être dans NavigationComponent ou un composant dédié)
  - [ ] Le toggle doit permettre de basculer entre clair et sombre
  - [ ] Le toggle doit appeler `SettingsService.applyTheme()` lors du changement
  - [ ] Le changement doit être appliqué immédiatement (AC: 6)
  - [ ] Ajouter des icônes ou indicateurs visuels pour le thème actif

- [ ] **Task 6: Add Theme Transitions** (AC: 8)
  - [ ] Ajouter des transitions CSS pour les propriétés qui changent avec le thème
  - [ ] Utiliser `transition` sur les propriétés de couleur (background, color, border-color)
  - [ ] Durée de transition appropriée (ex: 200-300ms)
  - [ ] Tester que les transitions sont fluides et agréables

- [ ] **Task 7: Test Theme System** (AC: 1-8)
  - [ ] Tester le chargement du thème au démarrage
  - [ ] Tester le changement de thème via le toggle
  - [ ] Tester la persistance du thème (rechargement de page)
  - [ ] Tester le thème par défaut si localStorage est vide
  - [ ] Tester les transitions entre thèmes
  - [ ] Tester sur différents navigateurs

---

## Dev Notes

### Previous Story Insights

**Source:** Story 1.5 - Settings Service with LocalStorage

- SettingsService est implémenté avec localStorage
- L'interface `UserSettings` est définie avec `theme: 'clair' | 'sombre'`
- Les réglages sont chargés automatiquement au démarrage
- La méthode `applyTheme()` existe mais n'est pas encore implémentée
- BehaviorSubject est configuré pour notifier les changements

### Technical Context

**Source:** [architecture/coding-standards.md](docs/architecture/coding-standards.md)

**Standards critiques:**
- **Responsive Design:** Utiliser CSS Variables pour thèmes, media queries pour responsive
- **CSS Variables:** Utiliser kebab-case avec `--` (ex: `--primary-color`)
- **CSS Classes:** Utiliser kebab-case (ex: `.theme-clair`)

**Source:** [architecture/tech-stack.md](docs/architecture/tech-stack.md)

- **CSS Framework:** Custom CSS/SCSS - CSS/SCSS standard avec CSS Variables pour thèmes, pas de framework externe

**Source:** [architecture/unified-project-structure.md](docs/architecture/unified-project-structure.md)

**Styles Structure:**
```
src/styles/
├── _variables.scss     # CSS Variables pour thèmes
├── _themes.scss        # Définitions thèmes
└── styles.scss         # Styles globaux
```

**Source:** [architecture/data-models.md](docs/architecture/data-models.md)

**UserSettings:**
- `theme: 'clair' | 'sombre'` - Thème sélectionné
- Géré par SettingsService
- Persisté dans localStorage

**Source:** [architecture/components.md](docs/architecture/components.md)

**SettingsService:**
- `applyTheme(theme: 'clair' | 'sombre'): void` - Applique le thème
- Dependencies: localStorage API, CSS Variables pour application des couleurs

**Source:** [front-end-spec.md](docs/front-end-spec.md)

**Design Principles:**
- **Personnalisation discrète:** Options de personnalisation disponibles mais non intrusives
- **Respect de la tradition:** Design inspiré de l'esthétique japonaise (simplicité, élégance)

**Source:** [front-end-spec.md](docs/front-end-spec.md)

**Component 6: Color Picker:**
- Color pickers avec validation de contraste (WCAG AA)
- Toggle thème avec transition fluide
- Retour automatique aux valeurs par défaut si nécessaire

**CSS Variables Pattern:**
```scss
// _variables.scss
:root {
  // Thème clair (par défaut)
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --text-primary: #333333;
  --text-secondary: #666666;
  --accent-primary: #007bff;
  --border-color: #e0e0e0;
}

.theme-sombre {
  --bg-primary: #1a1a1a;
  --bg-secondary: #2d2d2d;
  --text-primary: #ffffff;
  --text-secondary: #cccccc;
  --accent-primary: #4a9eff;
  --border-color: #404040;
}
```

**Theme Application Pattern:**
```typescript
// settings.service.ts
applyTheme(theme: 'clair' | 'sombre'): void {
  const rootElement = document.documentElement; // ou document.body
  rootElement.classList.remove('theme-clair', 'theme-sombre');
  rootElement.classList.add(`theme-${theme}`);
  
  this.updateSettings({ theme });
}
```

### File Locations

**Source:** [architecture/unified-project-structure.md](docs/architecture/unified-project-structure.md)

- **CSS Variables:** `src/styles/_variables.scss`
- **Theme Definitions:** `src/styles/_themes.scss`
- **Global Styles:** `src/styles/styles.scss`
- **SettingsService:** `src/app/services/settings.service.ts`
- **App Component:** `src/app/app.component.ts` (pour appliquer la classe sur l'élément racine)

### Testing Requirements

**Source:** [architecture/testing-strategy.md](docs/architecture/testing-strategy.md)

**Pour cette story:**
- Tests unitaires pour SettingsService.applyTheme()
- Tests d'intégration pour vérifier l'application du thème
- Tests visuels pour vérifier les transitions
- Framework: Jasmine + Karma (inclus avec Angular CLI)

**Test Scenarios:**
- Le thème est appliqué au démarrage
- Le changement de thème fonctionne via le toggle
- Le thème est persisté dans localStorage
- Le thème par défaut est "clair" si localStorage est vide
- Les transitions sont fluides

### Technical Constraints

**Source:** [architecture/coding-standards.md](docs/architecture/coding-standards.md)

- **CSS Variables:** Utiliser CSS Variables pour thèmes
- **Responsive Design:** Utiliser media queries pour responsive
- **Accessibility:** Conformité WCAG AA pour les contrastes de couleurs

**Source:** [front-end-spec.md](docs/front-end-spec.md)

- **Accessibility:** Conformité WCAG AA pour garantir l'accessibilité
- **Design Principles:** Simplicité avant tout, respect de la tradition

### Project Structure Notes

**Source:** [architecture/unified-project-structure.md](docs/architecture/unified-project-structure.md)

La structure doit suivre exactement le schéma défini dans l'architecture. Les fichiers SCSS doivent être dans `src/styles/` et importés dans `styles.scss`.

**Thème par défaut:**
- Le thème par défaut est "clair" si aucun n'est sauvegardé
- Le thème doit être appliqué dès le chargement de l'application

**Transitions:**
- Utiliser `transition` sur les propriétés de couleur
- Durée appropriée (200-300ms) pour des transitions fluides
- Tester sur différents navigateurs

**Note importante:**
- Le toggle de thème peut être intégré dans NavigationComponent ou créé comme composant séparé
- Les couleurs personnalisées (bannière, footer) seront gérées dans une story future
- Pour l'instant, se concentrer sur le système de thème clair/sombre de base

---

## Testing

### Testing Standards

**Source:** [architecture/testing-strategy.md](docs/architecture/testing-strategy.md)

**Test File Location:**
- Tests unitaires: `src/app/services/settings.service.spec.ts` (pour applyTheme)
- Tests d'intégration: Peuvent être dans les tests de composants

**Testing Framework:**
- Jasmine + Karma (inclus avec Angular CLI)

**Testing Patterns:**
- Utiliser `TestBed` pour la configuration des tests
- Tester l'application de la classe CSS sur l'élément racine
- Tester la persistance du thème

**Pour cette story:**
- Tests unitaires pour SettingsService.applyTheme()
- Tests d'intégration pour vérifier l'application du thème
- Tests visuels pour vérifier les transitions (tests manuels)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Création initiale de la story | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used

_(À remplir par le Dev Agent lors de l'implémentation)_

### Debug Log References

_(À remplir par le Dev Agent lors de l'implémentation)_

### Completion Notes List

_(À remplir par le Dev Agent lors de l'implémentation)_

### File List

_(À remplir par le Dev Agent lors de l'implémentation)_

---

## QA Results

_(À remplir par le QA Agent lors de la review)_
