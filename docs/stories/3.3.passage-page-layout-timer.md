# Story 3.3: Passage Page Layout and Timer

**Status:** Draft  
**Epic:** 3 - Passage Generation & Core Execution  
**Story Number:** 3.3  

---

## Story

**As a** user,  
**I want** voir une page dédiée au passage avec un timer visible,  
**so that** je peux suivre le temps écoulé pendant mon entraînement.

---

## Acceptance Criteria

1. La page de passage (`/passage`) est créée avec un layout épuré et centré
2. Un timer visible en haut de la page affiche le temps écoulé depuis le début (format MM:SS)
3. Le timer se met à jour en temps réel (toutes les secondes)
4. Le timer est bien visible et lisible (grande taille de police, contraste approprié)
5. Le timer s'arrête quand le passage est en pause
6. Le timer reprend quand le passage est repris
7. Le design est optimisé pour être visible à distance (utilisation mobile debout)

---

## Tasks / Subtasks

- [ ] **Task 1: Create Passage Page Layout** (AC: 1, 7)
  - [ ] Créer/améliorer le layout de PassageComponent (layout épuré et centré)
  - [ ] Optimiser pour utilisation mobile debout (design à distance)
  - [ ] Structurer le HTML avec sections appropriées
  - [ ] Appliquer des styles CSS pour layout épuré

- [ ] **Task 2: Create Timer Display Component/Section** (AC: 2, 4)
  - [ ] Créer l'affichage du timer en haut de la page
  - [ ] Format MM:SS pour le temps écoulé
  - [ ] Grande taille de police (minimum 48px sur mobile, plus sur desktop)
  - [ ] Contraste élevé pour lisibilité maximale
  - [ ] Styles CSS appropriés (couleur, taille, contraste)

- [ ] **Task 3: Integrate PassageService State** (AC: 3, 5, 6)
  - [ ] Injecter PassageService dans PassageComponent
  - [ ] Souscrire à getPassageState() pour obtenir elapsedTime
  - [ ] Formater elapsedTime en MM:SS
  - [ ] Mettre à jour le timer toutes les secondes
  - [ ] Gérer pause/resume (timer s'arrête/reprend)

- [ ] **Task 4: Implement Timer Formatting** (AC: 2)
  - [ ] Créer méthode formatTime(seconds: number): string
  - [ ] Convertir secondes en format MM:SS
  - [ ] Gérer l'affichage (pads avec zéros si nécessaire)

- [ ] **Task 5: Implement Real-time Updates** (AC: 3)
  - [ ] Utiliser Angular Change Detection ou Observable
  - [ ] Mettre à jour l'affichage automatiquement
  - [ ] Gérer les subscriptions (unsubscribe dans ngOnDestroy)

- [ ] **Task 6: Optimize for Distance Viewing** (AC: 7)
  - [ ] Taille de police adaptée (grande sur mobile, très grande sur desktop)
  - [ ] Espacement approprié pour visibilité à distance
  - [ ] Couleurs contrastées
  - [ ] Layout centré et épuré

- [ ] **Task 7: Handle Pause/Resume Timer** (AC: 5, 6)
  - [ ] Écouter isPaused dans l'état
  - [ ] Arrêter la mise à jour du timer en pause
  - [ ] Reprendre la mise à jour en resume
  - [ ] Visual feedback si nécessaire (opacité, couleur différente)

- [ ] **Task 8: Create Unit Tests** (AC: 1-7)
  - [ ] Tester l'affichage du timer
  - [ ] Tester le format MM:SS
  - [ ] Tester les mises à jour en temps réel
  - [ ] Tester pause/resume
  - [ ] Tester la souscription au PassageService

---

## Dev Notes

### Previous Story Insights

**Source:** Story 3.2 - Passage State Management
- PassageService.getPassageState() expose l'état réactif
- elapsedTime disponible dans PassageState
- isPaused disponible pour gérer pause/resume

**Source:** Story 1.2 - Routing Setup and Navigation
- PassageComponent existe avec route `/passage`
- Structure de base du composant en place

### Technical Context

**Source:** [architecture/frontend-architecture.md](../../architecture/frontend-architecture.md)

**PassageComponent:**
- **Location:** `src/app/pages/passage/passage.ts`, `passage.html`, `passage.scss`
- **Responsibility:** Affichage du passage en cours avec timer, techniques, progression
- **Dependencies:** PassageService pour l'état du passage

**State Subscription Pattern:**
```typescript
private subscriptions = new Subscription();

ngOnInit() {
  this.subscriptions.add(
    this.passageService.getPassageState().subscribe(state => {
      this.elapsedTime = state.elapsedTime;
      this.isPaused = state.isPaused;
    })
  );
}

ngOnDestroy() {
  this.subscriptions.unsubscribe();
}
```

**Timer Format:**
- Format MM:SS (ex: "05:23" pour 5 minutes 23 secondes)
- Padding avec zéros si nécessaire (ex: "00:05" pour 5 secondes)

**Design Considerations:**
- Mobile debout: Utilisation à distance (1-2 mètres)
- Grande taille de police: minimum 48px sur mobile, 64px+ sur desktop
- Contraste élevé: texte clair sur fond sombre ou vice-versa
- Layout épuré: pas de distractions, focus sur le timer

### Implementation Details

**Time Formatting:**
```typescript
formatTime(seconds: number): string {
  const minutes = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}
```

**Template Structure:**
```html
<div class="passage-page">
  <div class="timer-container">
    <div class="timer-display" [class.paused]="isPaused">
      {{ formatTime(elapsedTime) }}
    </div>
  </div>
  <!-- Autres sections à ajouter dans stories suivantes -->
</div>
```

**Styles CSS:**
```scss
.timer-display {
  font-size: 4rem; // 64px
  font-weight: bold;
  text-align: center;
  color: var(--text-primary);
  // Contraste élevé
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  
  &.paused {
    opacity: 0.7;
  }
}
```

---

## Dependencies

- ✅ Story 3.2 complétée (PassageService state management)
- ✅ Story 1.2 complétée (PassageComponent et route `/passage`)
- ✅ PassageService.getPassageState() disponible
- ✅ PassageState interface avec elapsedTime et isPaused

---

## Testing Checklist

- [ ] Test: Layout épuré et centré s'affiche correctement
- [ ] Test: Timer affiché en haut de la page
- [ ] Test: Format MM:SS correct
- [ ] Test: Timer se met à jour toutes les secondes
- [ ] Test: Taille de police appropriée (grande)
- [ ] Test: Contraste élevé (lisibilité)
- [ ] Test: Timer s'arrête en pause
- [ ] Test: Timer reprend en resume
- [ ] Test: Design optimisé pour distance (mobile debout)
- [ ] Test: Souscription au PassageService fonctionne
- [ ] Test: Unsubscribe dans ngOnDestroy

---

## Definition of Done

- ✅ Tous les Acceptance Criteria sont remplis
- ✅ Code compile sans erreurs
- ✅ Tests unitaires passent (couverture minimale 70%)
- ✅ Layout épuré et centré
- ✅ Timer visible et lisible
- ✅ Mise à jour en temps réel fonctionne
- ✅ Pause/resume fonctionne correctement
- ✅ Design optimisé pour utilisation mobile debout
- ✅ Code review effectué
- ✅ Documentation du code (JSDoc) ajoutée

---
